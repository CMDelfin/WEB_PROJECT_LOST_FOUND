{% extends 'base.html' %}
{% block content %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<div class="d-flex justify-content-center align-items-start" style="padding-top: 20px;">

    <div class="user-chat-container messages-page d-flex flex-column" 
         style="height: 500px; width: 1000px; border-radius: 12px; overflow: hidden;">

        <div class="messages-header flex-shrink-0 p-3" style="border-bottom: 1px solid #ccc;">
            <h5 class="fw-bold mb-0">Conversation with Admin</h5>
        </div>

        <div id="messagesContainer" class="messages-container overflow-auto flex-grow-1 p-3 d-flex flex-column">
            {% if messages %}
                {% for msg in messages|reverse %}
                    <div class="d-flex mb-2
                        {% if msg.sender_id == current_user.id %}justify-content-end{% else %}justify-content-start{% endif %}">
                        <div class="message-bubble {% if msg.sender_id == current_user.id %}message-right{% else %}message-left{% endif %}">
                            <small class="fw-bold d-block mb-1">
                                {% if msg.sender_id == current_user.id %}
                                    You
                                {% else %}
                                    Admin
                                {% endif %}
                            </small>
                            {{ msg.content }}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p class="text-muted text-center mt-3">No messages yet. Say hello to Admin!</p>
            {% endif %}
        </div>

        <div class="message-input flex-shrink-0 p-3">
            <form method="POST" action="{{ url_for('messages') }}" id="userMessageForm">
                <input type="hidden" name="receiver_id" value="{{ admin_user.id }}">
                <div class="input-wrapper d-flex">
                    <input type="text" name="content" placeholder="Type a message..." required class="form-control me-2" style="border: none; box-shadow: none;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </form>
        </div>

    </div>
</div>

<script>
const messagesContainer = document.getElementById('messagesContainer');
if(messagesContainer){

    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

const userForm = document.getElementById('userMessageForm');
if(userForm){
    userForm.addEventListener('submit', () => {
        setTimeout(() => {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }, 100);
    });
}
</script>
{% endblock %}
