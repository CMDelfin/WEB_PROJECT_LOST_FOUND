{% extends 'base.html' %}
{% block content %}

<div class="container py-4">
  <h2 class="fw-bold text-primary mb-4 text-center">üìã All Reported Items</h2>

  <div class="d-flex justify-content-center gap-4 mb-4 flex-wrap text-center">
    <div class="stat-box p-3 rounded shadow-sm">
      <h4 class="fw-bold">{{ total_items or 0 }}</h4><small>Total Items</small>
    </div>
    <div class="stat-box p-3 rounded shadow-sm">
      <h4 class="fw-bold text-warning">{{ total_lost or 0 }}</h4><small>Lost Items</small>
    </div>
    <div class="stat-box p-3 rounded shadow-sm">
      <h4 class="fw-bold text-success">{{ total_found or 0 }}</h4><small>Found Items</small>
    </div>
    <div class="stat-box p-3 rounded shadow-sm">
      <h4 class="fw-bold text-info">{{ total_resolved or 0 }}</h4><small>Resolved</small>
    </div>
  </div>

<form method="GET" class="mb-4">

  <div class="d-flex justify-content-center mb-2">
    <input type="text" name="search" class="form-control shadow-sm rounded-pill px-3"
           placeholder="Search..." value="{{ request.args.get('search', '') }}" style="max-width: 300px;">
  </div>

  <div class="d-flex justify-content-center gap-2">
    <select name="category" class="form-select shadow-sm rounded-pill px-3" style="width: 160px;">
      <option value="">All Categories</option>
      {% for cat in categories %}
        <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>{{ cat }}</option>
      {% endfor %}
    </select>

    <select name="status" class="form-select shadow-sm rounded-pill px-3" style="width: 140px;">
      <option value="">All Status</option>
      <option value="lost" {% if request.args.get('status') == 'lost' %}selected{% endif %}>Lost</option>
      <option value="found" {% if request.args.get('status') == 'found' %}selected{% endif %}>Found</option>
    </select>

    <button type="submit" class="btn btn-primary rounded-pill px-4">Filter</button>
  </div>

</form>

  {% if items %}
  <div class="table-responsive shadow-sm rounded-4 bg-white p-3">
    <table class="table table-hover align-middle text-center">
      <thead class="table-primary">
        <tr>
          <th>ID</th>
          <th>Image</th>
          <th>Item Name</th>
          <th>Description</th>
          <th>Location</th>
          <th>Category</th>
          <th>Status</th>
          <th>Resolved</th>
          <th>Date Reported</th>
          <th>Reported By</th>
        </tr>
      </thead>

      <tbody>
        {% for item in items %}
        <tr>
          <td>{{ item.id }}</td>

          <td>
            {% if item.image_filename %}
              <img 
                src="{{ url_for('static', filename='uploads/' ~ item.image_filename) }}"
                onclick="showImage(this.src)"
                style="height:60px; cursor:pointer;"
                class="rounded shadow-sm">
            {% else %}
              <span class="text-muted">No image</span>
            {% endif %}
          </td>

          <td>{{ item.name }}</td>
          <td class="text-muted">{{ item.description }}</td>
          <td>{{ item.location }}</td>
          <td>{{ item.category if item.category else 'N/A' }}</td>

          <td>
            {% if item.status == 'found' %}
              <span class="badge bg-success px-3 py-2 rounded-pill shadow-sm">Found</span>
            {% else %}
              <span class="badge bg-warning text-dark px-3 py-2 rounded-pill shadow-sm">Lost</span>
            {% endif %}
          </td>

          <td>
            {% if item.is_resolved %}
              <span class="badge bg-success px-3 py-2 rounded-pill shadow-sm">Yes</span>
            {% else %}
              <span class="badge bg-danger px-3 py-2 rounded-pill shadow-sm">No</span>
            {% endif %}
          </td>

          <td>
            {% if item.date_reported %}
              {{ item.date_reported.strftime('%Y-%m-%d') }}
            {% else %}
              <em class="text-muted">N/A</em>
            {% endif %}
          </td>

          <td>{{ item.user.username if item.user else "Unknown" }}</td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

  {% else %}
  <div class="text-center mt-5">
    <p class="text-muted fs-5">No items found. üïµÔ∏è‚Äç‚ôÄÔ∏è</p>
  </div>
  {% endif %}
</div>

<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-body p-0">
        <img id="modalImage" src="" class="w-100 rounded">
      </div>
    </div>
  </div>
</div>

<script>
  function showImage(src) {
    document.getElementById("modalImage").src = src;
    const modal = new bootstrap.Modal(document.getElementById('imageModal'));
    modal.show();
  }
</script>

{% endblock %}
